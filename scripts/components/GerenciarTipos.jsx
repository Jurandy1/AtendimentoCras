(() => {
  const { collection, query, onSnapshot, doc, updateDoc, addDoc, deleteDoc } = window.firebaseModules;
  const { Edit, Trash2, Palette } = window.Icons;
  const { CORES_TIPO_PADRAO } = window.Utils;
  const { useState, useEffect } = React;
const GerenciarTipos = ({ db, appId }) => { const [tipos, setTipos] = useState([]); const [loading, setLoading] = useState(true); const [formData, setFormData] = useState({ nome: '', cor: CORES_TIPO_PADRAO[0], ordem: 0 }); const [editingId, setEditingId] = useState(null); const [showModal, setShowModal] = useState(false); const collectionPath = `artifacts/${appId}/public/data/tipos_atendimento`; useEffect(() => { if (!db) return; setLoading(true); const q = query(collection(db, collectionPath)); const unsubscribe = onSnapshot(q, (snapshot) => { const dataList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); dataList.sort((a, b) => (a.ordem || 0) - (b.ordem || 0)); setTipos(dataList); setLoading(false); }, () => { setLoading(false); }); return () => unsubscribe(); }, [db, appId, collectionPath]); const handleChange = (e) => { const { name, value, type } = e.target; setFormData(prev => ({ ...prev, [name]: type === 'number' ? parseInt(value) : value })); }; const resetForm = () => { setFormData({ nome: '', cor: CORES_TIPO_PADRAO[0], ordem: 0 }); setEditingId(null); setShowModal(false); }; const handleSubmit = async (e) => { e.preventDefault(); if (!db) return; try { if (editingId) { const docRef = doc(db, collectionPath, editingId); await updateDoc(docRef, formData); } else { await addDoc(collection(db, collectionPath), formData); } resetForm(); } catch (error) {} }; const handleEdit = (tipo) => { setFormData({ nome: tipo.nome, cor: tipo.cor, ordem: tipo.ordem || 0 }); setEditingId(tipo.id); setShowModal(true); }; const handleDelete = async (id) => { try { const docRef = doc(db, collectionPath, id); await deleteDoc(docRef); } catch (error) {} }; return (<div className="p-4"><div className="flex justify-between items-center mb-4"><h3 className="text-2xl font-semibold">Gerenciar Tipos de Atendimento</h3><button onClick={() => { resetForm(); setShowModal(true); }} className="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-colors"><Palette size={18} className="mr-2" /> Novo Tipo</button></div>{showModal && (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg"><h4 className="text-xl font-semibold mb-4">{editingId ? 'Editar Tipo' : 'Novo Tipo'}</h4><form onSubmit={handleSubmit} className="space-y-4"><input name="nome" value={formData.nome} onChange={handleChange} placeholder="Nome" required className="w-full p-2 border rounded-lg" /><input name="ordem" type="number" value={formData.ordem} onChange={handleChange} placeholder="Ordem" required className="w-full p-2 border rounded-lg" /><div><div className="flex flex-wrap gap-2">{CORES_TIPO_PADRAO.map(cor => (<button type="button" key={cor} onClick={() => setFormData(prev => ({ ...prev, cor }))} className={`w-8 h-8 rounded-full border-2 ${formData.cor === cor ? 'border-blue-600 ring-2 ring-blue-300' : 'border-transparent'}`} style={{ backgroundColor: cor }}></button>))}<input type="color" name="cor" value={formData.cor} onChange={handleChange} className="w-10 h-8 p-0 border-none rounded-lg cursor-pointer" /></div></div><div className="flex justify-end space-x-2"><button type="button" onClick={resetForm} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancelar</button><button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">{editingId ? 'Atualizar' : 'Salvar'}</button></div></form></div></div>)}{loading ? (<p>Carregando tipos de atendimento...</p>) : (<div className="bg-white shadow rounded-lg overflow-x-auto"><table className="w-full min-w-[600px]"><thead className="bg-gray-50"><tr><th className="p-3 text-left text-sm font-semibold text-gray-600">Cor</th><th className="p-3 text-left text-sm font-semibold text-gray-600">Nome</th><th className="p-3 text-left text-sm font-semibold text-gray-600">Ordem</th><th className="p-3 text-left text-sm font-semibold text-gray-600">Ações</th></tr></thead><tbody className="divide-y divide-gray-200">{tipos.map(tipo => (<tr key={tipo.id}><td className="p-3"><div className="w-6 h-6 rounded-md" style={{ backgroundColor: tipo.cor }}></div></td><td className="p-3">{tipo.nome}</td><td className="p-3">{tipo.ordem}</td><td className="p-3"><div className="flex space-x-2"><button onClick={() => handleEdit(tipo)} className="text-blue-600 hover:text-blue-800"><Edit size={18} /></button><button onClick={() => handleDelete(tipo.id)} className="text-red-600 hover:text-red-800"><Trash2 size={18} /></button></div></td></tr>))}</tbody></table></div>)}</div>); };
  window.Components = window.Components || {}; window.Components.GerenciarTipos = GerenciarTipos;
})();
