(() => {
  const { query, collection, where, onSnapshot, Timestamp } = window.firebaseModules;
  const { Loader } = window.Icons;
  const { getStartOfToday } = window.Utils;
  const { useState, useEffect, useMemo } = React;
const Dashboard = ({ db, appId }) => { const [allAtendimentos, setAllAtendimentos] = useState([]); const [loading, setLoading] = useState(true); const collectionPath = `artifacts/${appId}/public/data/atendimentos`; useEffect(() => { if (!db) return; setLoading(true); const q = query(collection(db, collectionPath), where("hora_chegada", ">=", Timestamp.fromDate(getStartOfToday()))); const unsubscribe = onSnapshot(q, (snapshot) => { const dataList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); setAllAtendimentos(dataList); setLoading(false); }, () => { setLoading(false); }); return () => unsubscribe(); }, [db, appId, collectionPath]); const stats = useMemo(() => { const total = allAtendimentos.length; const finalizados = allAtendimentos.filter(a => a.status === 'finalizado'); const emAtendimento = allAtendimentos.filter(a => a.status === 'em_atendimento'); const aguardando = allAtendimentos.filter(a => a.status === 'aguardando'); let tempoMedio = 0; if (finalizados.length > 0) { const duracoes = finalizados.map(a => { if (a.hora_inicio && a.hora_fim) { const start = a.hora_inicio.toDate(); const end = a.hora_fim.toDate(); return Math.max(1, Math.round((end.getTime() - start.getTime()) / (1000 * 60))); } return 0; }); tempoMedio = Math.round(duracoes.reduce((acc, v) => acc + v, 0) / finalizados.length); } return { total, finalizados: finalizados.length, emAtendimento: emAtendimento.length, aguardando: aguardando.length, tempoMedio }; }, [allAtendimentos]); return (<div className="p-6"><h2 className="text-3xl font-bold text-gray-800 mb-6">Dashboard</h2>{loading ? (<div className="h-64 flex items-center justify-center"><Loader className="animate-spin h-12 w-12" /></div>) : (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><div className="bg-white p-6 rounded-lg shadow"><h3 className="text-sm font-medium text-gray-600">Total de Atendimentos</h3><p className="text-3xl font-bold">{stats.total}</p></div><div className="bg-white p-6 rounded-lg shadow"><h3 className="text-sm font-medium text-gray-600">Finalizados</h3><p className="text-3xl font-bold">{stats.finalizados}</p></div><div className="bg-white p-6 rounded-lg shadow"><h3 className="text-sm font-medium text-gray-600">Em Atendimento</h3><p className="text-3xl font-bold">{stats.emAtendimento}</p></div><div className="bg-white p-6 rounded-lg shadow"><h3 className="text-sm font-medium text-gray-600">Aguardando</h3><p className="text-3xl font-bold">{stats.aguardando}</p></div><div className="bg-white p-6 rounded-lg shadow md:col-span-2"><h3 className="text-sm font-medium text-gray-600">Tempo MÃ©dio (min)</h3><p className="text-3xl font-bold">{stats.tempoMedio}</p></div></div>)}</div>); };
  window.Components = window.Components || {}; window.Components.Dashboard = Dashboard;
})();
